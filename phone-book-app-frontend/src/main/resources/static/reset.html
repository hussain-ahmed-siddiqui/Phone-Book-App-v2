<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, 
    initial-scale=1.0">
    <title>Reset Password</title>
    <link rel="stylesheet" href="/Stylesheets/login_signup.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    
    <div class="wrapper">
        <!--Login page,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,-->
        <form id="newPassword" class="input-group">
            <!--login , name and password -->
            <h1>Reset Password</h1>
            <div class="input-box">
                <h3>Create New Password</h3>
                <input required id="password" name="password" type="Password" 
                placeholder="Password">
                <i class='bx bxs-user'></i>
            </div>
            <div class="input-box">
                <h3>Confirm Password</h3>
                <input required id="cpassword" name="cpassword" type="Password" 
            placeholder="Password">
        <input id="phoneNum" name="phoneNum" type="number" hidden="hidden">

                <i class='bx bxs-lock-alt'></i>
            </div>
            
            <!--Remember me-->
            <div class="remember-forgot">
                
                
            </div>
            <!-- Error Message for Password Mismatch -->
            <p id="password-error" style="color: red;"></p>
            <!--Login Button-->
            <button id="resetButton" type="button" class="btn">Confirm Reset</button>

            <!--Registration link-->
            
            <div class="register-link">
                <!-- <p>Don't have an account? <a href="/register" id="show-register-form">Register</a></p> -->
            </div>

        </form>
    

   
    </div>


    
    
<script>
    document.getElementById('phoneNum').setAttribute('value',localStorage.getItem('phoneNum'));
    localStorage.removeItem('phoneNum');

    // Password Validation
        // Event Listener for Reset Button
        document.getElementById('resetButton').addEventListener('click', async () => {
            const passwordInput = document.getElementById('password').getAttribute('value');
            const confirmPasswordInput = document.getElementById('cpassword').getAttribute('value');
            const passwordError = document.getElementById('password-error');

           

            // Check if passwords match
            if (passwordInput !== confirmPasswordInput) {
                passwordError.textContent = 'Passwords do not match.';
                return;
            }


            // Perform your API call here
            const phoneNum = document.getElementById('phoneNum').value;
            const url = new URL('/accounts/password-reset', 'http://localhost:8080');
            url.searchParams.append('phoneNum', phoneNum);
            url.searchParams.append('password',password);
            try {
                console.log("bruh")
                const response = await fetch(url, {
                    method: 'POST'
                    });
                const data = response.json();    
                    // Password reset was successful, you can handle the response here
                    localStorage.removeItem('phoneNum');
                    window.location.href = 'http://localhost:8081/login';
            } catch (error) {
                console.error('Error:', error);
            }
        });
</script>
    
</body>
</html>


